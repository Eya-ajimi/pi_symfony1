{% extends 'backend/base.html.twig' %}

{% block title %}Dashboard{% endblock %}

{% block stylesheets %}
{{parent()}}
    <link rel="stylesheet" href="{{ asset('assets/css2/css/styles.min.css') }}">
    <link rel="shortcut icon" type="image/png" href="{{ asset('assets/css/images/logos/favicon.png') }}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .dashboard-container {
            padding-top: 2rem;
            margin-top: 2rem;
        }
        .stat-card {
            transition: transform 0.3s ease;
            margin-bottom: 1.5rem;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .stat-label {
            color: #6c757d;
            font-size: 1rem;
        }
        .stat-percentage {
            font-size: 0.875rem;
            color: #28a745;
        }
        .stat-percentage.negative {
            color: #dc3545;
        }
        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border: none;
            margin-bottom: 1.5rem;
        }
        .card-body {
            padding: 1.5rem;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .border-left-primary {
            border-left: 0.25rem solid #4e73df !important;
        }
        .border-left-success {
            border-left: 0.25rem solid #1cc88a !important;
        }
        .border-left-info {
            border-left: 0.25rem solid #36b9cc !important;
        }
        .border-left-warning {
            border-left: 0.25rem solid #f6c23e !important;
        }
        .dropdown-menu {
            max-height: 200px;
            overflow-y: auto;
        }
        .progress-sm {
            height: 10px;
            border-radius: 5px;
        }
       

         .chart-fullsize {
        height: 600px !important;
    }
    .chart-bar {
        transition: height 0.3s ease;
    }
    </style>
{% endblock %}

{% block content %}
<div class="container-fluid dashboard-container">
    <!-- Year Selector -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">User Registration Statistics</h1>
        <div class="dropdown">
            <button class="btn btn-primary dropdown-toggle shadow-sm" type="button" id="yearDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-calendar-alt fa-sm mr-2"></i>Year: {{ selectedYear }}
            </button>
            <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="yearDropdown">
                <h6 class="dropdown-header">Select Year</h6>
                <div class="dropdown-divider"></div>
                {% for year in availableYears %}
                    <a class="dropdown-item {% if year == selectedYear %}active{% endif %}"
                       href="{{ path('app_admin_dashboard1', {'year': year}) }}">
                        {{ year }}
                    </a>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- User Statistics Row -->
    <div class="row mb-4">
        <div class="col-xl-3 col-sm-6">
            <div class="card border-left-primary shadow stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-users stat-icon text-primary"></i>
                    <div class="stat-value">{{ totalUsers }}</div>
                    <div class="stat-label">Total Users</div>
                    <div class="stat-percentage">
                        <i class="fas fa-arrow-up"></i> {{ activePercentage }}% Active
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card border-left-success shadow stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-user stat-icon text-success"></i>
                    <div class="stat-value">{{ clients }}</div>
                    <div class="stat-label">Clients</div>
                    <div class="stat-percentage">
                        <i class="fas fa-chart-pie"></i> {{ clientPercentage }}% of total
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card border-left-warning shadow stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-store stat-icon text-warning"></i>
                    <div class="stat-value">{{ shopOwners }}</div>
                    <div class="stat-label">Shop Owners</div>
                    <div class="stat-percentage">
                        <i class="fas fa-chart-pie"></i> {{ shopOwnerPercentage }}% of total
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card border-left-danger shadow stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-user-shield stat-icon text-danger"></i>
                    <div class="stat-value">{{ admins }}</div>
                    <div class="stat-label">Administrators</div>
                    <div class="stat-percentage">
                        <i class="fas fa-chart-pie"></i> {{ adminPercentage }}% of total
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Monthly Registration Chart -->
   <div class="container-fluid dashboard-container">
    <!-- Monthly Registration Chart -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Monthly User Registration ({{ selectedYear }})</h6>
                </div>
                <div class="card-body">
                    <div class="chart-bar" style="position: relative; height:300px; width:100%">
                        <canvas id="monthlyRegistrationChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get data from Twig
        const monthlyStats = {{ monthlyStats|json_encode|raw }};
        const ctx = document.getElementById('monthlyRegistrationChart');
        
        // Verify data and canvas element exist
        if (!monthlyStats || monthlyStats.length === 0) {
            console.error('No data available for chart');
            return;
        }
        
        if (!ctx) {
            console.error('Canvas element not found');
            return;
        }

        // Create the chart
        new Chart(ctx.getContext('2d'), {
            type: 'bar',
            data: {
                labels: monthlyStats.map(stat => stat.month),
                datasets: [
                    {
                        label: 'Clients',
                        data: monthlyStats.map(stat => stat.clients),
                        backgroundColor: '#4e73df',
                        borderColor: '#2e59d9',
                        borderWidth: 1
                    },
                    {
                        label: 'Shop Owners',
                        data: monthlyStats.map(stat => stat.shopOwners),
                        backgroundColor: '#f6c23e',
                        borderColor: '#dda20a',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        grid: { display: false }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: { precision: 0 }
                    }
                }
            }
        });
    });
    </script>
{% endblock %}
