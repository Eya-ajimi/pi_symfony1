{% extends 'base.html.twig' %}

{% block title %}Connexion{% endblock %}

{% block content %}
<main class="main-content mt-0">
  <div class="page-header align-items-start min-vh-100" style="background-image: url('{{ asset('images/back.jpg') }}'); background-size: cover; background-position: center;">
    <span class="mask" style="background: none;"></span>

    <div class="container my-auto">
      <div class="row justify-content-center">
        <div class="col-lg-5 col-md-7">
          <div class="card border-0 shadow-lg rounded-4 animate-card" style="
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
          ">

            <div class="card-header text-white text-center py-4 rounded-top-4" style="background: rgba(0, 0, 0, 0.6);">
              <h4 class="mb-0 fw-bold text-white">
                <i class="fas fa-sign-in-alt me-2 text-white"></i>Connexion
              </h4>
            </div>

            <div class="card-body px-4 py-4">
              {% for flash_error in app.flashes('error') %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                  {{ flash_error }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
              {% endfor %}

              {{ form_start(loginForm, {
                'attr': {
                  'class': 'text-start',
                  'novalidate': 'novalidate'
                }
              }) }}

              <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">

              <div class="input-group mb-4">
                <span class="input-group-text bg-white"><i class="fas fa-envelope text-dark"></i></span>
                {{ form_widget(loginForm.email, {
                  'attr': {
                    'class': 'form-control',
                    'autocomplete': 'email',
                    'placeholder': 'Adresse email'
                  }
                }) }}
              </div>

              <div class="input-group mb-4">
                <span class="input-group-text bg-white"><i class="fas fa-lock text-dark"></i></span>
                {{ form_widget(loginForm.mot_de_passe, {
                  'attr': {
                    'class': 'form-control',
                    'autocomplete': 'current-password',
                    'placeholder': 'Mot de passe'
                  }
                }) }}
              </div>

              {# üõ°Ô∏è reCAPTCHA ici #}
              <div class="mb-4 text-center">
                <div class="g-recaptcha" data-sitekey="6LcmgCYrAAAAAHqsHZ5M9iGmXNRanBSpnuXx5qEJ"></div>
              </div>

              <div class="text-center">
                <button type="submit" class="btn btn-dark w-100 fw-bold" style="transition: all 0.3s ease;">
                  <i class="fas fa-arrow-right-to-bracket me-2"></i>Se connecter
                </button>
              </div>

              <div class="text-center mt-3">
                <a href="{{ path('app_forgot_password_request') }}" style="color: white;" class="fw-bold text-sm">
                  <i class="fas fa-unlock-alt me-1"></i>Mot de passe oubli√© ?
                </a>
              </div>

              <div class="text-center mt-4">
                <button type="button" class="btn btn-danger w-100 fw-bold" data-bs-toggle="modal" data-bs-target="#roleModal">
                  <i class="fab fa-google me-2"></i> Se connecter avec Google
                </button>
              </div>

              <p class="text-center mt-4 mb-0 text-sm" style="color: black;">
                Vous n'avez pas de compte ?
                <a href="{{ path('app_choose_role') }}" style="color: white;" class="fw-bold">
                  <i class="fas fa-user-plus me-1"></i>Cr√©er un compte
                </a>
              </p>

              {{ form_end(loginForm) }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Modal pour s√©lectionner le r√¥le -->
<div class="modal fade" id="roleModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">S√©lectionnez votre r√¥le</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <p>Comment souhaitez-vous utiliser notre plateforme ?</p>
        <div class="d-grid gap-3">
          <a href="{{ path('connect_google_start', {'role': 'CLIENT'}) }}" class="btn btn-primary btn-lg">
            <i class="fas fa-user me-2"></i> Je suis un Client
          </a>
          <a href="{{ path('connect_google_start', {'role': 'SHOPOWNER'}) }}" class="btn btn-secondary btn-lg">
            <i class="fas fa-store me-2"></i> Je suis un Commer√ßant
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

{# Font Awesome pour les ic√¥nes #}
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

{# Script reCAPTCHA #}
<script src="https://www.google.com/recaptcha/api.js" async defer></script>

{# ‚ú® Animation fade-in-slide-up pour la card #}
<style>
@keyframes fadeSlideCard {
  0% {
    opacity: 0;
    transform: translateY(40px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}
.animate-card {
  animation: fadeSlideCard 0.9s ease-out forwards;
  opacity: 0;
}
</style>
{% endblock %}
